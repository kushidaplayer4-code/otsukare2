<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>スマホ間違い探し 完全版</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  background: #fff;
  padding: 10px;
}
.game-area {
  position: relative;
  display: inline-block;
}
img {
  width: 90vw;
  max-width: 400px;
  height: auto; /* ← 縦横比固定 */
  border: 2px solid #000;
  display: block;
  margin-bottom: 10px;
}
.marker {
  position: absolute;
  width: 32px;
  height: 32px;
  border: 3px solid red;
  border-radius: 50%;
  pointer-events: none;
  transform: translate(-50%, -50%);
  animation: pop 0.25s ease-out;
}
@keyframes pop {
  0% { transform: translate(-50%, -50%) scale(0); }
  100% { transform: translate(-50%, -50%) scale(1); }
}
#message {
  margin-top: 12px;
  padding: 10px;
  font-size: 16px;
  background: #f5f5f5;
  border-radius: 8px;
  min-height: 2.5em;
}
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  flex-direction: column;
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  display: none;
  animation: sparkle 1.5s infinite;
}
@keyframes sparkle {
  0%,100% { background: rgba(255,255,255,0.7); }
  50% { background: rgba(255,255,255,0.85); }
}
</style>
</head>
<body>

<h2>間違い探し</h2>
<p>2枚の画像を比べて、違うところをタップ！</p>

<div class="game-area" id="gameArea">
  <img src="image1.JPG" alt="画像A" id="img1">
  <img src="image2.PNG" alt="画像B（間違いあり）" id="img2">
</div>

<div id="message">どこが違うかな？</div>

<div id="overlay">お疲れ様でした。<br>宮城県の治安を守ってください。</div>

<script>
// ===== 元画像サイズ =====
const originalWidth = 800;
const originalHeight = 600;

// ===== 正解座標と文章 =====
const differences = [
  { x1: 207, y1: 10, x2: 321, y2: 116, found: false, text: "ディズニーランドじゃないのに耳つけてて浮かれてるね！" },
  { x1: 127, y1: 206, x2: 172, y2: 248, found: false, text: "いやらしい本を見てにやにやしているね！" },
  { x1: 285, y1: 304, x2: 311, y2: 322, found: false, text: "カバンに職場のロゴをつけていて忠誠心抜群だ！" }
];

const img1 = document.getElementById("img1");
const img2 = document.getElementById("img2");
const gameArea = document.getElementById("gameArea");
const message = document.getElementById("message");
const overlay = document.getElementById("overlay");

// ===== スマホ対応の座標スケーリング =====
function scaleDifferences() {
  const displayWidth = img2.clientWidth;
  const displayHeight = img2.clientHeight;
  const scaleX = displayWidth / originalWidth;
  const scaleY = displayHeight / originalHeight;
  differences.forEach(d => {
    // 少し範囲を広げてタップしやすくする
    const padding = 10; 
    d.x1_scaled = d.x1 * scaleX - padding;
    d.x2_scaled = d.x2 * scaleX + padding;
    d.y1_scaled = d.y1 * scaleY - padding;
    d.y2_scaled = d.y2 * scaleY + padding;
  });
}

// ページ読み込み後にスケール計算
window.addEventListener("load", scaleDifferences);
window.addEventListener("resize", scaleDifferences);

// ===== タップ処理 =====
img2.addEventListener("click", (e) => {
  const rect = img2.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  let correct = false;

  differences.forEach(diff => {
    if (!diff.found &&
        x >= diff.x1_scaled && x <= diff.x2_scaled &&
        y >= diff.y1_scaled && y <= diff.y2_scaled) {
      diff.found = true;
      correct = true;

      // 文章表示
      message.textContent = diff.text;

      // バイブレーション
      if (navigator.vibrate) navigator.vibrate(200);

      // 赤丸を両方の画像に表示
      [img1, img2].forEach(img => {
        const marker = document.createElement("div");
        marker.className = "marker";
        marker.style.left = `${(diff.x1_scaled + diff.x2_scaled)/2}px`;
        marker.style.top = `${(diff.y1_scaled + diff.y2_scaled)/2}px`;
        img.parentElement.appendChild(marker);
      });
    }
  });

  if (!correct) {
    message.textContent = "ちがうよ！";
  }

  // クリア判定
  if (differences.every(d => d.found)) {
    overlay.style.display = "flex";
  }
});
</script>

</body>
</html>